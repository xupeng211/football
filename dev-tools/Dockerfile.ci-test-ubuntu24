# ğŸ³ çœŸå®GitHub Actions CIç¯å¢ƒ - Ubuntu 24.04 + Python 3.12
FROM ubuntu:24.04

# è®¾ç½®éäº¤äº’å¼å®‰è£…
ENV DEBIAN_FRONTEND=noninteractive
ENV PYTHONUNBUFFERED=1
ENV PYTHON_VERSION=3.11

# å®‰è£…ç³»ç»Ÿä¾èµ–ï¼ˆæ¨¡æ‹ŸçœŸå®GitHub Actions runnersï¼‰
RUN apt-get update && apt-get install -y \
    software-properties-common \
    curl \
    git \
    build-essential \
    && add-apt-repository ppa:deadsnakes/ppa \
    && apt-get update \
    && apt-get install -y \
    python3.11 \
    python3.11-dev \
    python3.11-venv \
    python3.11-distutils \
    && rm -rf /var/lib/apt/lists/*

# è®¾ç½®Python 3.11ï¼ˆGitHub Actionsä¼šå®‰è£…ç‰¹å®šç‰ˆæœ¬ï¼‰
RUN update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.11 1
RUN update-alternatives --install /usr/bin/python python /usr/bin/python3.11 1

# å®‰è£…uvï¼ˆå®Œå…¨æ¨¡æ‹Ÿsetup-uv@v3ï¼‰
RUN curl -LsSf https://astral.sh/uv/install.sh | sh
ENV PATH="/root/.local/bin:/root/.cargo/bin:$PATH"

# å·¥ä½œç›®å½•
WORKDIR /workspace

# æ¨¡æ‹ŸGitHub Actionsç¯å¢ƒå˜é‡
ENV PYTHONPATH=/workspace/src
ENV UV_CACHE_DIR=/tmp/.uv-cache
ENV GITHUB_WORKSPACE=/workspace

# é»˜è®¤æ‰§è¡ŒCIéªŒè¯è„šæœ¬
CMD ["./ci-verify.sh"] 