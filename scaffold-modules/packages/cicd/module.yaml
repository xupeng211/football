# 🔧 CI/CD模块配置
# CI/CD Module - 完整的持续集成和部署流水线

name: "cicd"
display_name: "🔧 CI/CD流水线模块"
version: "2.0.0"
description: "完整的CI/CD流水线，包含代码质量检查、安全扫描、自动化测试等"

# 模块类型
type: "feature"
required: false

# 依赖关系
dependencies:
  - "core" # 依赖核心模块

# 冲突模块
conflicts: []

# 子模块支持
sub_modules:
  basic:
    description: "基础CI流程"
    files:
      - ".github/workflows/ci.yml"
      - "scripts/ci-unified.sh"

  security:
    description: "安全扫描增强"
    files:
      - ".github/workflows/security.yml"
      - ".gitleaks.toml"
      - ".github/workflows/codeql.yml"

  advanced:
    description: "高级监控和通知"
    files:
      - ".github/workflows/coverage.yml"
      - ".github/workflows/notify-on-failure.yml"

# 模块文件列表
files:
  # GitHub Actions工作流
  - src: ".github/workflows/ci.yml"
    dest: ".github/workflows/ci.yml"
    type: "workflow"
    description: "主CI流水线"
    sub_module: "basic"

  - src: ".github/workflows/security.yml"
    dest: ".github/workflows/security.yml"
    type: "workflow"
    description: "安全扫描工作流"
    sub_module: "security"

  - src: ".github/workflows/coverage.yml"
    dest: ".github/workflows/coverage.yml"
    type: "workflow"
    description: "覆盖率监控工作流"
    sub_module: "advanced"

  # CI脚本
  - src: "scripts/ci-unified.sh"
    dest: "scripts/ci-unified.sh"
    type: "script"
    description: "统一CI检查脚本"
    sub_module: "basic"

  - src: "scripts/pre-push-check.sh"
    dest: "scripts/pre-push-check.sh"
    type: "script"
    description: "推送前检查脚本"
    sub_module: "basic"

  - src: "scripts/quality-check.py"
    dest: "scripts/quality-check.py"
    type: "script"
    description: "代码质量检查脚本"
    sub_module: "basic"

  # 配置文件
  - src: ".pre-commit-config.yaml"
    dest: ".pre-commit-config.yaml"
    type: "config"
    description: "Pre-commit钩子配置"
    sub_module: "basic"

  - src: ".gitleaks.toml"
    dest: ".gitleaks.toml"
    type: "config"
    description: "秘密泄露检测配置"
    sub_module: "security"

  - src: ".coveragerc"
    dest: ".coveragerc"
    type: "config"
    description: "测试覆盖率配置"
    sub_module: "advanced"

# 安装后执行的命令
post_install:
  commands:
    - "chmod +x scripts/ci-*.sh scripts/pre-push-check.sh"
    - "pre-commit install"
    - "pre-commit install --hook-type pre-push"

  messages:
    - "🎉 CI/CD模块安装完成！"
    - "🔧 Pre-commit钩子已安装"
    - "🚀 运行 scripts/ci-unified.sh --mode=quick 进行快速检查"
    - "🛡️ 安全扫描和质量门禁已配置"

# 系统要求
requirements:
  git: ">=2.30"
  pre-commit: ">=2.15.0"

# 功能特性
features:
  - "continuous_integration"
  - "code_quality"
  - "security_scanning"
  - "automated_testing"
  - "pre_commit_hooks"

# 估算指标
metrics:
  files_count: 12
  install_time_seconds: 45
  setup_complexity: "medium"
  maintenance_effort: "low"

# 版本历史
changelog:
  "2.0.0":
    - "统一CI脚本集成"
    - "增强安全扫描"
    - "优化工作流性能"
  "1.0.0":
    - "初始CI/CD实现"
