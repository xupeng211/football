# 🐳 容器化模块配置
# Docker Module - 完整的容器化部署解决方案

name: "docker"
display_name: "🐳 容器化部署模块"
version: "2.0.0"
description: "完整的Docker容器化解决方案，支持多环境部署和服务编排"

# 模块类型
type: "feature"
required: false

# 依赖关系
dependencies:
  - "core"

# 冲突模块
conflicts: []

# 子模块支持
sub_modules:
  basic:
    description: "基础容器化"
    files:
      - "Dockerfile"
      - "docker-compose.base.yml"
      - "docker-compose.override.yml"

  services:
    description: "数据库和缓存服务"
    files:
      - "docker-compose.yml"
      - "infra/config/postgresql.conf"
      - "infra/config/redis.conf"

  monitoring:
    description: "监控和日志服务"
    files:
      - "docker-compose.monitoring.yml"
      - "infra/config/nginx.conf"

# 模块文件列表
files:
  # Docker镜像配置
  - src: "Dockerfile"
    dest: "Dockerfile"
    type: "config"
    description: "主应用Docker镜像"
    sub_module: "basic"

  - src: "Dockerfile.api"
    dest: "Dockerfile.api"
    type: "config"
    description: "API服务专用镜像"
    sub_module: "basic"

  - src: ".dockerignore"
    dest: ".dockerignore"
    type: "config"
    description: "Docker构建忽略文件"
    sub_module: "basic"

  # Docker Compose编排
  - src: "docker-compose.base.yml"
    dest: "docker-compose.base.yml"
    type: "config"
    description: "基础服务配置"
    sub_module: "basic"

  - src: "docker-compose.override.yml"
    dest: "docker-compose.override.yml"
    type: "config"
    description: "开发环境覆盖配置"
    sub_module: "basic"

  - src: "docker-compose.yml"
    dest: "docker-compose.yml"
    type: "config"
    description: "完整服务编排"
    sub_module: "services"

  - src: "docker-compose.prod.yml"
    dest: "docker-compose.prod.yml"
    type: "config"
    description: "生产环境配置"
    sub_module: "services"

  - src: "docker-compose.monitoring.yml"
    dest: "docker-compose.monitoring.yml"
    type: "config"
    description: "监控服务配置"
    sub_module: "monitoring"

  # 基础设施配置
  - src: "infra/config/nginx.conf"
    dest: "infra/config/nginx.conf"
    type: "config"
    description: "Nginx反向代理配置"
    sub_module: "monitoring"

  - src: "infra/config/redis.conf"
    dest: "infra/config/redis.conf"
    type: "config"
    description: "Redis缓存配置"
    sub_module: "services"

  - src: "infra/config/postgresql.conf"
    dest: "infra/config/postgresql.conf"
    type: "config"
    description: "PostgreSQL数据库配置"
    sub_module: "services"

  # 辅助脚本
  - src: "infra/scripts/docker-health-check.sh"
    dest: "infra/scripts/docker-health-check.sh"
    type: "script"
    description: "容器健康检查脚本"

  - src: "infra/scripts/container-logs.sh"
    dest: "infra/scripts/container-logs.sh"
    type: "script"
    description: "容器日志管理脚本"

# 安装后执行的命令
post_install:
  commands:
    - "chmod +x infra/scripts/*.sh"
    - "mkdir -p infra/config infra/scripts"
    - "docker --version || echo 'Warning: Docker not found'"

  messages:
    - "🎉 Docker模块安装完成！"
    - "🐳 容器化配置已就绪"
    - "🚀 运行 docker-compose up 启动开发环境"
    - "📊 使用 docker-compose -f docker-compose.monitoring.yml up 启动监控"
    - "🔧 查看 infra/scripts/ 目录获取管理脚本"

# 系统要求
requirements:
  docker: ">=20.10"
  docker-compose: ">=1.29.0"

# 功能特性
features:
  - "containerization"
  - "service_orchestration"
  - "multi_environment"
  - "health_monitoring"
  - "scalable_architecture"

# 估算指标
metrics:
  files_count: 13
  install_time_seconds: 60
  setup_complexity: "medium"
  maintenance_effort: "low"

# 版本历史
changelog:
  "2.0.0":
    - "分层配置继承"
    - "优化服务编排"
    - "增加监控支持"
  "1.0.0":
    - "基础Docker支持"
