# ğŸ³ å®¹å™¨åŒ–æ¨¡å—é…ç½®
# Docker Module - å®Œæ•´çš„å®¹å™¨åŒ–éƒ¨ç½²è§£å†³æ–¹æ¡ˆ

name: "docker"
display_name: "ğŸ³ å®¹å™¨åŒ–éƒ¨ç½²æ¨¡å—"
version: "2.0.0"
description: "å®Œæ•´çš„Dockerå®¹å™¨åŒ–è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¤šç¯å¢ƒéƒ¨ç½²å’ŒæœåŠ¡ç¼–æ’"

# æ¨¡å—ç±»å‹
type: "feature"
required: false

# ä¾èµ–å…³ç³»
dependencies:
  - "core"

# å†²çªæ¨¡å—
conflicts: []

# å­æ¨¡å—æ”¯æŒ
sub_modules:
  basic:
    description: "åŸºç¡€å®¹å™¨åŒ–"
    files:
      - "Dockerfile"
      - "docker-compose.base.yml"
      - "docker-compose.override.yml"

  services:
    description: "æ•°æ®åº“å’Œç¼“å­˜æœåŠ¡"
    files:
      - "docker-compose.yml"
      - "infra/config/postgresql.conf"
      - "infra/config/redis.conf"

  monitoring:
    description: "ç›‘æ§å’Œæ—¥å¿—æœåŠ¡"
    files:
      - "docker-compose.monitoring.yml"
      - "infra/config/nginx.conf"

# æ¨¡å—æ–‡ä»¶åˆ—è¡¨
files:
  # Dockeré•œåƒé…ç½®
  - src: "Dockerfile"
    dest: "Dockerfile"
    type: "config"
    description: "ä¸»åº”ç”¨Dockeré•œåƒ"
    sub_module: "basic"

  - src: "Dockerfile.api"
    dest: "Dockerfile.api"
    type: "config"
    description: "APIæœåŠ¡ä¸“ç”¨é•œåƒ"
    sub_module: "basic"

  - src: ".dockerignore"
    dest: ".dockerignore"
    type: "config"
    description: "Dockeræ„å»ºå¿½ç•¥æ–‡ä»¶"
    sub_module: "basic"

  # Docker Composeç¼–æ’
  - src: "docker-compose.base.yml"
    dest: "docker-compose.base.yml"
    type: "config"
    description: "åŸºç¡€æœåŠ¡é…ç½®"
    sub_module: "basic"

  - src: "docker-compose.override.yml"
    dest: "docker-compose.override.yml"
    type: "config"
    description: "å¼€å‘ç¯å¢ƒè¦†ç›–é…ç½®"
    sub_module: "basic"

  - src: "docker-compose.yml"
    dest: "docker-compose.yml"
    type: "config"
    description: "å®Œæ•´æœåŠ¡ç¼–æ’"
    sub_module: "services"

  - src: "docker-compose.prod.yml"
    dest: "docker-compose.prod.yml"
    type: "config"
    description: "ç”Ÿäº§ç¯å¢ƒé…ç½®"
    sub_module: "services"

  - src: "docker-compose.monitoring.yml"
    dest: "docker-compose.monitoring.yml"
    type: "config"
    description: "ç›‘æ§æœåŠ¡é…ç½®"
    sub_module: "monitoring"

  # åŸºç¡€è®¾æ–½é…ç½®
  - src: "infra/config/nginx.conf"
    dest: "infra/config/nginx.conf"
    type: "config"
    description: "Nginxåå‘ä»£ç†é…ç½®"
    sub_module: "monitoring"

  - src: "infra/config/redis.conf"
    dest: "infra/config/redis.conf"
    type: "config"
    description: "Redisç¼“å­˜é…ç½®"
    sub_module: "services"

  - src: "infra/config/postgresql.conf"
    dest: "infra/config/postgresql.conf"
    type: "config"
    description: "PostgreSQLæ•°æ®åº“é…ç½®"
    sub_module: "services"

  # è¾…åŠ©è„šæœ¬
  - src: "infra/scripts/docker-health-check.sh"
    dest: "infra/scripts/docker-health-check.sh"
    type: "script"
    description: "å®¹å™¨å¥åº·æ£€æŸ¥è„šæœ¬"

  - src: "infra/scripts/container-logs.sh"
    dest: "infra/scripts/container-logs.sh"
    type: "script"
    description: "å®¹å™¨æ—¥å¿—ç®¡ç†è„šæœ¬"

# å®‰è£…åæ‰§è¡Œçš„å‘½ä»¤
post_install:
  commands:
    - "chmod +x infra/scripts/*.sh"
    - "mkdir -p infra/config infra/scripts"
    - "docker --version || echo 'Warning: Docker not found'"

  messages:
    - "ğŸ‰ Dockeræ¨¡å—å®‰è£…å®Œæˆï¼"
    - "ğŸ³ å®¹å™¨åŒ–é…ç½®å·²å°±ç»ª"
    - "ğŸš€ è¿è¡Œ docker-compose up å¯åŠ¨å¼€å‘ç¯å¢ƒ"
    - "ğŸ“Š ä½¿ç”¨ docker-compose -f docker-compose.monitoring.yml up å¯åŠ¨ç›‘æ§"
    - "ğŸ”§ æŸ¥çœ‹ infra/scripts/ ç›®å½•è·å–ç®¡ç†è„šæœ¬"

# ç³»ç»Ÿè¦æ±‚
requirements:
  docker: ">=20.10"
  docker-compose: ">=1.29.0"

# åŠŸèƒ½ç‰¹æ€§
features:
  - "containerization"
  - "service_orchestration"
  - "multi_environment"
  - "health_monitoring"
  - "scalable_architecture"

# ä¼°ç®—æŒ‡æ ‡
metrics:
  files_count: 13
  install_time_seconds: 60
  setup_complexity: "medium"
  maintenance_effort: "low"

# ç‰ˆæœ¬å†å²
changelog:
  "2.0.0":
    - "åˆ†å±‚é…ç½®ç»§æ‰¿"
    - "ä¼˜åŒ–æœåŠ¡ç¼–æ’"
    - "å¢åŠ ç›‘æ§æ”¯æŒ"
  "1.0.0":
    - "åŸºç¡€Dockeræ”¯æŒ"
