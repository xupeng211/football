# ğŸ³ æœ¬åœ°CIéªŒè¯ç¯å¢ƒ - æ¨¡æ‹ŸGitHub Actions
FROM ubuntu:22.04

# è®¾ç½®éäº¤äº’å¼å®‰è£…
ENV DEBIAN_FRONTEND=noninteractive
ENV PYTHONUNBUFFERED=1
ENV PYTHON_VERSION=3.11

# å®‰è£…ç³»ç»Ÿä¾èµ–ï¼ˆæ¨¡æ‹ŸGitHub Actions runnersï¼‰
RUN apt-get update && apt-get install -y \
    python3.11 \
    python3.11-dev \
    python3.11-venv \
    python3-pip \
    curl \
    git \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# è®¾ç½®Python 3.11ä¸ºé»˜è®¤
RUN update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.11 1
RUN update-alternatives --install /usr/bin/python python /usr/bin/python3.11 1

# å®‰è£…uvï¼ˆå’ŒGitHub Actions setup-uv@v3ç›¸åŒæ–¹å¼ï¼‰
RUN curl -LsSf https://astral.sh/uv/install.sh | sh
ENV PATH="/root/.local/bin:/root/.cargo/bin:$PATH"
RUN echo 'export PATH="/root/.local/bin:/root/.cargo/bin:$PATH"' >> /root/.bashrc

# åˆ›å»ºå·¥ä½œç›®å½•
WORKDIR /workspace

# æ¨¡æ‹ŸGitHub Actionsçš„ç¯å¢ƒå˜é‡
ENV PYTHONPATH=/workspace/src
ENV UV_CACHE_DIR=/tmp/.uv-cache

# é»˜è®¤æ‰§è¡ŒCIéªŒè¯è„šæœ¬
CMD ["./ci-verify.sh"] 