# ğŸš€ Lightweight CI - å¿«é€ŸéªŒè¯å·¥ä½œæµ
name: Lightweight-CI

on:
  push:
    branches: [main, dev]
  pull_request:
    branches: [main, dev]

env:
  PYTHON_VERSION: "3.11"
  DATABASE_URL: "sqlite:///./test.db"
  ENVIRONMENT: "testing"
  CI: "true"

jobs:
  fast-validation:
    name: ğŸš€ Fast Code Validation
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          
      - name: Install uv and dependencies
        run: |
          curl -LsSf https://astral.sh/uv/install.sh | sh
          echo "$HOME/.local/bin" >> $GITHUB_PATH
          uv sync --extra dev
          
      - name: âœ… Run CI Checks (æœ¬åœ°=CIä¸€è‡´)
        run: |
          echo "ğŸš€ è¿è¡ŒCIçº§åˆ«æ£€æŸ¥ (ä¸æœ¬åœ°make ci-checkå®Œå…¨ä¸€è‡´)..."
          make ci-check
          
      - name: âœ… Basic Module Import Test
        run: |
          echo "ğŸ“¦ æµ‹è¯•æ ¸å¿ƒæ¨¡å—å¯¼å…¥..."
          uv run python -c "
          import sys
          sys.path.insert(0, 'src')
          
          from football_predict_system.core.config import get_settings
          from football_predict_system.domain.models import Team, Match
          print('âœ… æ ¸å¿ƒæ¨¡å—å¯¼å…¥æˆåŠŸ')
          "
          
      - name: âœ… SQLite Database Test
        run: |
          echo "ğŸ—„ï¸ æµ‹è¯•SQLiteæ•°æ®åº“åŠŸèƒ½..."
          uv run python -c "
          import sys
          sys.path.insert(0, 'src')
          
          from football_predict_system.core.database import get_database_manager
          from football_predict_system.core.config import get_settings
          
          settings = get_settings()
          print(f'ä½¿ç”¨æ•°æ®åº“: {settings.get_database_url()}')
          
          # åŸºç¡€æ•°æ®åº“ç®¡ç†å™¨æµ‹è¯•
          db_manager = get_database_manager()
          print('âœ… æ•°æ®åº“ç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ')
          "

  validation-summary:
    name: ğŸ“‹ Validation Summary
    runs-on: ubuntu-latest
    needs: [fast-validation]
    if: always()
    
    steps:
      - name: Generate Summary
        run: |
          echo "ğŸ† LIGHTWEIGHT CI SUMMARY"
          echo "========================="
          echo "ğŸ“… æ—¶é—´: $(date)"
          echo "ğŸš€ å¿«é€ŸéªŒè¯: ${{ needs.fast-validation.result }}"
          
          if [[ "${{ needs.fast-validation.result }}" == "success" ]]; then
            echo "âœ… ä»£ç è´¨é‡éªŒè¯é€šè¿‡ï¼"
            echo "ğŸ¯ åŸºç¡€åŠŸèƒ½æ­£å¸¸"
            echo "ğŸš€ å¯ä»¥å®‰å…¨ç»§ç»­å¼€å‘"
          else
            echo "âŒ éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä»£ç "
            exit 1
          fi 