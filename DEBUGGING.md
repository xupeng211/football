# 本地调试指南

本文档旨在提供一个在本地模拟CI环境的标准化流程，以帮助开发者在推送到远程仓库前发现并修复问题，从而提高CI的通过率和开发效率。

## 先决条件

- **Docker**: 确保你的开发环境中已安装并运行Docker。

## 如何在本地运行CI检查

我们提供了一个一键式脚本 `scripts/run-ci-local.sh`，它会自动完成所有CI环境的搭建、测试和清理工作。

### 快速开始

在项目根目录下，运行以下命令：

```bash
./scripts/run-ci-local.sh
```

### 脚本执行流程

该脚本将按顺序执行以下操作：

1.  **构建Docker镜像**: 基于项目根目录下的 `Dockerfile` 创建一个名为 `football-ci-local` 的镜像。这个镜像包含了与GitHub Actions一致的所有系统依赖和Python库。
2.  **创建隔离网络**: 创建一个名为 `football-net-local` 的Docker网络，以隔离CI环境。
3.  **启动数据库服务**: 在此网络中启动一个PostgreSQL容器，作为测试数据库。
4.  **等待数据库就绪**: 脚本会智能等待，直到数据库完全准备好接受连接。
5.  **运行CI测试容器**: 启动一个测试容器，并连接到数据库。容器内将执行以下命令：
    *   `make format`
    *   `make lint`
    *   `make type`
    *   `make security`
    *   `make validate`
    *   `make test`
6.  **自动清理**: 无论脚本成功或失败，它都会自动停止并移除所有相关的Docker容器和网络，确保你的开发环境保持整洁。

### 调试技巧

- 如果本地CI运行失败，脚本会显示详细的错误日志。你可以根据日志定位问题。
- 如果需要进入容器内部进行更深入的调试，可以注释掉 `run-ci-local.sh` 中的 `cleanup` 函数调用，然后在另一个终端中使用 `docker exec -it football-ci-runner /bin/bash` 进入正在运行的容器。

通过遵循本指南，你可以在本地高效地模拟和解决CI问题，从而确保代码质量和团队的开发效率。
